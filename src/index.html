<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de Comisiones - SERSA</title>
    <link rel="stylesheet" href="comisiones.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
<div class="container-fluid">
    <div class="row g-3" id="container">
    <aside id="sidebar" class="col-12 col-md-4 col-lg-3">
        <header>
            <h1>Comisiones SERSA</h1>
            <select id="profileSelect" onchange="changeProfile(this.value)">
                <option value="agil_1">√Ågil 1</option>
                <option value="agil_2">√Ågil 2</option>
                <option value="empresarial_1">Empresarial 1</option>
                <option value="empresarial_2">Empresarial 2</option>
            </select>
            <label class="theme-switch" for="themeToggle">
                <input type="checkbox" id="themeToggle" aria-label="Modo oscuro">
                <span>üåô</span>
            </label>
            <div class="pdf-menu">
                <button type="button" class="header-btn" onclick="togglePDFMenu()" aria-haspopup="true" aria-expanded="false">üìÑ PDF ‚ñº</button>
                <div class="pdf-menu-options" id="pdfMenuOptions" role="menu">
                    <button type="button" role="menuitem" onclick="descargarPDF()">üìÑ PDF Simple</button>
                    <button type="button" role="menuitem" onclick="generateProfessionalPDF()">üìä PDF Profesional</button>
                </div>
            </div>
        </header>
        <form id="datosForm" class="mt-3">
            <div class="mb-3">
                <label for="nivelAnterior" class="form-label"><span class="icon">üèÖ</span> Nivel anterior</label>
                <select id="nivelAnterior" class="form-select">
                    <option value="0">Capilla</option>
                    <option value="1">Junior</option>
                    <option value="2" selected>Senior A</option>
                    <option value="3">Senior B</option>
                    <option value="4">M√°ster</option>
                    <option value="5">Genio</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="montoInterno" class="form-label"><span class="icon">üíº</span> Monto Interno*</label>
                <input type="text" id="montoInterno" class="form-control" inputmode="numeric" required aria-label="Monto Interno" aria-describedby="descMontoInterno">
                <small id="descMontoInterno" class="form-text">Monto total de operaciones internas</small>
                <div id="progInterno" class="progress my-2">
                    <div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div>
                </div>
            </div>
            <div class="mb-3">
                <label for="montoExterno" class="form-label"><span class="icon">üåê</span> Monto Externo*</label>
                <input type="text" id="montoExterno" class="form-control" inputmode="numeric" required aria-label="Monto Externo" aria-describedby="descMontoExterno">
                <small id="descMontoExterno" class="form-text">Monto total de operaciones externas</small>
                <div id="progExterno" class="progress my-2">
                    <div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div>
                </div>
            </div>
            <div class="mb-3">
                <label for="montoRecuperado" class="form-label"><span class="icon">‚ôªÔ∏è</span> Recuperados*</label>
                <input type="text" id="montoRecuperado" class="form-control" inputmode="numeric" required aria-label="Monto Recuperado" aria-describedby="descRecuperado">
                <small id="descRecuperado" class="form-text">Monto recuperado superior a 3M</small>
                <div id="progRecuperado" class="progress my-2">
                    <div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div>
                </div>
            </div>
            <div class="mb-3">
                <label for="cantidad" class="form-label"><span class="icon">üî¢</span> Cantidad*</label>
                <input type="number" id="cantidad" class="form-control" required aria-label="Cantidad de desembolsos" aria-describedby="descCantidad">
                <small id="descCantidad" class="form-text">N√∫mero total de desembolsos</small>
                <div id="progCantidad" class="progress my-2">
                    <div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div><div class="progress-bar progress-segment"></div>
                </div>
            </div>
            <div class="mb-3">
                <label for="menorSemana" class="form-label"><span class="icon">üìÖ</span> Menor Semana*</label>
                <input type="number" id="menorSemana" class="form-control" min="0" max="4" required aria-label="Menor semana" aria-describedby="descSemana">
                <small id="descSemana" class="form-text">Semanas con al menos un desembolso</small>
            </div>
            <div class="mb-3">
                <label for="nivelEquipo" class="form-label"><span class="icon">üë•</span> Menor nivel del equipo</label>
                <select id="nivelEquipo" class="form-select">
                    <option value="0">Capilla</option>
                    <option value="1">Junior</option>
                    <option value="2">Senior A</option>
                    <option value="3">Senior B</option>
                    <option value="4">M√°ster</option>
                    <option value="5">Genio</option>
                </select>
            </div>
            <fieldset class="mb-3">
                <legend>Multiplicadores (%)</legend>
                <div class="row g-2">
                    <div class="col-6">
                        <label for="conv" class="form-label"><span class="icon">üéØ</span> Conversi√≥n</label>
                        <input type="number" id="conv" class="form-control" required aria-label="Porcentaje de conversi√≥n" aria-describedby="descConv">
                        <small id="descConv" class="form-text">Resultado de conversi√≥n (%)</small>
                    </div>
                    <div class="col-6">
                        <label for="emp" class="form-label"><span class="icon">ü§ù</span> Empat√≠a</label>
                        <input type="number" id="emp" class="form-control" required aria-label="Porcentaje de empat√≠a" aria-describedby="descEmp">
                        <small id="descEmp" class="form-text">Puntuaci√≥n de empat√≠a</small>
                    </div>
                    <div class="col-6">
                        <label for="proc" class="form-label"><span class="icon">üìà</span> Proceso</label>
                        <input type="number" id="proc" class="form-control" required aria-label="Porcentaje de proceso" aria-describedby="descProc">
                        <small id="descProc" class="form-text">Calidad de proceso CRM</small>
                    </div>
                    <div class="col-6">
                        <label for="mora" class="form-label"><span class="icon">‚è≥</span> Mora</label>
                        <input type="number" id="mora" class="form-control" required aria-label="Porcentaje de mora" aria-describedby="descMora">
                        <small id="descMora" class="form-text">Porcentaje de mora</small>
                    </div>
                </div>
            </fieldset>
        </form>
    </aside>
    <main id="result">
        <div class="kpi-card total">
            <h2>Comisi√≥n Final</h2>
            <div id="comisionTotal">0</div>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card">
                <span id="kpiNivel">-</span>
                <small>Nivel</small>
            </div>
            <div class="kpi-card">
                <span id="kpiSubtotal">0</span>
                <small>Subtotal</small>
            </div>
            <div class="kpi-card">
                <span id="kpiMultiplicador">0</span>
                <small>Multiplicador</small>
            </div>
        </div>
        <canvas id="chartComision" width="300" height="300" aria-label="Composici√≥n"></canvas>
        <canvas id="chartComparativo" width="300" height="200" aria-label="Cumplimiento"></canvas>
        <div id="gauges">
            <canvas id="gaugeConv" width="120" height="60" aria-label="Conv"></canvas>
            <canvas id="gaugeEmp" width="120" height="60" aria-label="Emp"></canvas>
            <canvas id="gaugeProc" width="120" height="60" aria-label="Proc"></canvas>
            <canvas id="gaugeMora" width="120" height="60" aria-label="Mora"></canvas>
        </div>
        <section id="detalle"></section>
        <section id="gamification">
            <h3>Logros</h3>
            <ul id="logrosList"></ul>

            <div class="proyeccion">
                <label for="metaSlider">¬øQu√© pasar√≠a si tu meta fuera <span id="metaValue">0</span> Gs?</label>
                <input type="range" id="metaSlider" min="0" max="20000000" step="1000000">
                <div class="progress-ring">
                    <svg width="120" height="120">
                        <circle id="progressBg" cx="60" cy="60" r="50" stroke="#E0E0E0" stroke-width="10" fill="none" />
                        <circle id="progressRing" cx="60" cy="60" r="50" stroke="#4CAF50" stroke-width="10" fill="none" />
                    </svg>
                    <span id="progressRingText">0%</span>
                </div>
            </div>

            <div id="ranking">
                <p>Posici√≥n simulada: <span id="rankingPos">-</span></p>
                <p>Est√°s en el top <span id="topPercent">-</span>%</p>
            </div>

            <div id="motivationalQuote"></div>

            <button id="shareImageBtn" type="button" onclick="shareResults()">Compartir Resultados</button>
        </section>
    </main>
    </div>
</div>
<div id="tourOverlay" class="tour-overlay hidden">
    <div class="tour-content">
        <p>Bienvenido al sistema de comisiones. Aqu√≠ podr√°s ingresar tus datos y ver el resultado en tiempo real.</p>
        <label><input type="checkbox" id="dontShowTour"> No mostrar de nuevo</label>
        <button onclick="closeTour()">Cerrar</button>
    </div>
</div>

<button id="quickSettingsBtn" class="fab" aria-label="Ajustes R√°pidos">‚öôÔ∏è</button>
<div id="quickSettingsPanel" class="quick-settings hidden" aria-hidden="true">
    <div class="qs-header">
        <h3>Ajustes R√°pidos</h3>
        <button id="closeQsBtn" type="button" aria-label="Cerrar">‚úñÔ∏è</button>
    </div>
    <div class="qs-content">
        <label for="qsProfile">Perfil</label>
        <select id="qsProfile"></select>

        <label for="qsTheme">Tema</label>
        <select id="qsTheme">
            <option value="light">Claro</option>
            <option value="dark">Oscuro</option>
        </select>

        <div class="qs-actions">
            <button id="qsExport" type="button">Exportar</button>
            <button id="qsImport" type="button">Importar</button>
        </div>

        <ul id="qsHistory" class="qs-history"></ul>
    </div>
</div>
<script type="module" src="app.js"></script>
</body>
</html>
